%% Making figure to illustrate idealized disease progression time series
onset = [3 1.5];
slope = [3 5];
nr_t = 1e3;
t = linspace(0, 6, nr_t);

nr_roi = length(onset);
atrophy = zeros(nr_t, nr_roi);
for o = 1:nr_roi,
    
    atrophy(:, o) = 1./(1 + exp(slope(o)*(t - onset(o))));
    
end

figure(1), clf, hold on
colour_vec = 'brcm';
for o = 1:nr_roi,

    plot(t, atrophy(:, o), colour_vec(o), 'LineWidth', 4)
    
end
hxlabel = xlabel('disease progression');
hylabel = ylabel('event measure');
hlegend = legend('Region 1', ...
    'Region 2');
set(hlegend, ...
    'FontName', 'Helvetica', ...
    'FontSize', 14, ...
    'Interpreter', 'latex')
set(gca, ...
  'Box'         , 'off'     , ...
  'TickDir'     , 'out'     , ...
  'TickLength'  , [.02 .02] , ...
  'XMinorTick'  , 'off'      , ...
  'YMinorTick'  , 'off'      , ...
  'XGrid'       , 'on'      , ...
  'YGrid'       , 'on'      , ...
  'XColor'      , [.3 .3 .3], ...
  'YColor'      , [.3 .3 .3], ...
  'XTick'       , []        , ...
  'YTick'       , 0:0.2:1, ...
  'LineWidth'   , 2);
set([hxlabel, hylabel]  , ...
    'FontSize'   , 18, ...
    'FontName',  'Helvetica', ...
    'FontWeight', 'Bold');

%% Single event measurement time line
clear all
close all

onset = [3];
slope = [3];
nr_t = 50;
nr_controls = 20;
nr_patients = 50;
t = linspace(0, 6, nr_patients);

atrophy_controls_nonoise = 1;
atrophy_controls_noise = atrophy_controls_nonoise + ...
    0.1*randn(nr_controls, 1);
atrophy_patients_nonoise = (1./(1 + exp(slope*(t - onset))))';
atrophy_patients_noise = atrophy_patients_nonoise + ...
    0.1*randn(nr_patients, 1);
figure(1), clf, hold on
colour_vec = 'b';
hAtrophy_patients_nonoise = plot(t, atrophy_patients_nonoise, ...
    colour_vec, 'LineWidth', 4);
hAtrophy_controls_noise = line(2*rand(nr_controls, 1), atrophy_controls_noise);
hAtrophy_patients_noise = line(t, atrophy_patients_noise);

hxlabel = xlabel('disease progression');
hylabel = ylabel('event measure');
set(gca, ...
  'Box'         , 'off'     , ...
  'TickDir'     , 'out'     , ...
  'TickLength'  , [.02 .02] , ...
  'XMinorTick'  , 'off'      , ...
  'YMinorTick'  , 'off'      , ...
  'XGrid'       , 'on'      , ...
  'YGrid'       , 'on'      , ...
  'XColor'      , [.3 .3 .3], ...
  'YColor'      , [.3 .3 .3], ...
  'XTick'       , []        , ...
  'YTick'       , -0.4:0.2:1.4, ...
  'LineWidth'   , 2);
set(hAtrophy_controls_noise                         , ...
    'LineStyle'         , 'none'      , ...
    'Marker'            , 'o'         , ...
    'MarkerSize'        , 6           , ...
    'MarkerEdgeColor'   , 'none'      , ...
    'MarkerFaceColor'   , [0 1 0] )
set(hAtrophy_patients_noise                         , ...
    'LineStyle'         , 'none'      , ...
    'Marker'            , 'o'         , ...
    'MarkerSize'        , 6           , ...
    'MarkerEdgeColor'   , 'none'      , ...
    'MarkerFaceColor'   , [1 0 0] )
set([hxlabel, hylabel]  , ...
    'FontSize'   , 18, ...
    'FontName',  'Helvetica', ...
    'FontWeight', 'Bold');


%% Something on the side... Making a variance figure
var_mat = [7686 2221 63 30
    1532 5232 2621 615
    769 1523 6211 1497
    70 143 1823 7964];    

figure(2), clf
imagesc(var_mat)
map_inverted = repmat(linspace(1, 0, 64)', 1, 3);
colormap(map_inverted)
axis equal, axis off
grid minor

%% Making the mixture figure
gmix_controls = gmm(1, 1, 'full');
gmix_controls.centres = 0.95;
gmix_controls.covars = 1e-3;
nr_controls = 100;
nr_patients_gmix = 20;
nr_patients_uniform = 80;
a_uniform = 0.6;
b_uniform = 1;

data_controls = gmmsamp(gmix_controls, nr_controls);
data_patients = gmmsamp(gmix_controls, nr_patients_gmix);
data_patients = cat(1, data_patients, ...
    (b_uniform - a_uniform)*rand(nr_patients_uniform, 1) + a_uniform);
data_tot = cat(1, data_controls, data_patients);

p_gmix = gmmprob(gmix_controls, data_tot);
p_uniform = 4*ones(length(data_tot), 1);
p_uniform(data_tot > gmix_controls.centres) = 0;

[n_c, x_c] = hist(data_controls, 10);
[n_p, x_p] = hist(data_patients, 25);

figure(1), clf, hold on
bar(x_c, n_c, 1, 'g')
bar(x_p, n_p, 1, 'r')
plot(data_tot, 2*p_gmix, '.g')
plot(data_tot, p_uniform, '.r')
axis square, grid off
hxlabel = xlabel('event measure');
hylabel = ylabel('data likelihood')
set(gca, ...
  'Box'         , 'off'     , ...
  'TickDir'     , 'out'     , ...
  'TickLength'  , [.02 .02] , ...
  'XMinorTick'  , 'off'      , ...
  'YMinorTick'  , 'off'      , ...
  'XGrid'       , 'on'      , ...
  'YGrid'       , 'on'      , ...
  'XColor'      , [.3 .3 .3], ...
  'YColor'      , [.3 .3 .3], ...
  'XTick'       , [0.5:0.1:1.2]        , ...
  'YTick'       , 0:5:40, ...
  'LineWidth'   , 2);
set([hxlabel, hylabel]  , ...
    'FontSize'   , 18, ...
    'FontName',  'Helvetica', ...
    'FontWeight', 'Bold');



